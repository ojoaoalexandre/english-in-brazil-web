(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[492],{72934:function(e,s,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/space/[slug]",function(){return n(16569)}])},16569:function(e,s,n){"use strict";n.r(s),n.d(s,{__N_SSP:function(){return S},default:function(){return _}});var t=n(26042),r=n(69396),a=n(85893),l=n(67294),i=n(54748),c=n(13174),d=n(83898),o=n(16940),u=n(47568),x=n(34051),h=n.n(x),m=n(47516),f=n(28750),p=function(){var e=(0,u.Z)(h().mark((function e(s,n){var t,r;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("".concat("https://cadastro.englishinbrazil.com.br","/api/post/").concat(s,"/messages"),{method:"GET",headers:{Accept:"application/json",Authorization:"Bearer ".concat(n)}});case 3:return t=e.sent,e.next=6,t.json();case 6:return r=e.sent,e.abrupt("return",r);case 10:e.prev=10,e.t0=e.catch(0),console.log(e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(s,n){return e.apply(this,arguments)}}(),g=p,j=n(62461),v=n(73753),N=n(16718),b=function(e){var s,n=e.id,t=e.content,r=e.sentAt,l=e.reactions,i=e.aluno,c=e.handleShowSender,d=e.responseToMessageId,o=e.handleReaction;return(0,a.jsxs)("section",{className:"flex gap-2",children:[(0,a.jsx)("div",{children:(0,a.jsx)(v.Z,{title:"avatar",size:"xsmall",path:(0,j.qR)(null===i||void 0===i||null===(s=i.avatar)||void 0===s?void 0:s.url)})}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("div",{className:"bg-gray-200 dark:bg-theme-gray-600 rounded-lg px-4 py-1",children:[(0,a.jsxs)("header",{className:"flex gap-2 items-center",children:[(0,a.jsx)("span",{className:"text-sm font-bold",children:null===i||void 0===i?void 0:i.primeiroNome}),(0,a.jsx)("span",{className:"text-xs",children:(0,j.Ny)(r,!1)})]}),(0,a.jsx)("p",{className:"text-sm",children:t})]}),l&&Object.keys(l).length>0?(0,a.jsxs)("div",{className:"flex items-center absolute -right-1 gap-1 rounded-full bottom-2 text-xs bg-gray-300 dark:bg-theme-gray-800 dark:text-white px-2",children:[(0,a.jsx)("span",{children:"\u2764\ufe0f"}),(0,a.jsx)("span",{children:Object.keys(l).length})]}):null,(0,a.jsxs)("footer",{className:"pl-2 flex gap-4 text-xs",children:[(0,a.jsx)("button",{onClick:function(){return d?o("like",d,i.id,n):o("like",n,i.id)},className:"flex gap-2",children:(0,a.jsx)("span",{className:"hover:underline",children:"Gostei"})}),(0,a.jsx)("button",{children:(0,a.jsx)("span",{onClick:function(){return c(d||n)},className:"hover:underline",children:"Responder"})})]})]})]})},k=n(87536),w=function(e){var s=e.id,n=e.fromStudentId,l=e.responseToMessageId,i=(0,k.cI)(),c=i.register,d=i.handleSubmit,o=i.reset;return(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("div",{children:(0,a.jsx)(v.Z,{title:"avatar",size:"xsmall"})}),(0,a.jsxs)("form",{onSubmit:d((function(e){var t=e.message;f.W.emit("send_message",{id:s,fromStudentId:n,message:t,responseToMessageId:l}),o()})),className:"flex flex-col grow",children:[(0,a.jsx)("textarea",(0,r.Z)((0,t.Z)({placeholder:"Adicione o seu coment\xe1rio"},c("message",{required:!0})),{className:"bg-gray-200 dark:bg-theme-gray-600 grow rounded-lg px-2 py-1"})),(0,a.jsx)("div",{className:"flex py-1",children:(0,a.jsx)("button",{className:"text-sm px-2 rounded-sm border dark:border-theme-gray-800",children:"Enviar"})})]})]})},y=function(e){var s,n=e.id,i=e.title,c=e.content,d=(e.slug,e.image,e.Message),o=e.reactions,x=e.createdAt,p=e.me,k=e.token,y=e.aluno,S=(0,l.useState)(d),_=S[0],I=S[1],Z=(0,l.useState)(),O=Z[0],E=Z[1],T=(0,l.useState)((function(){return o?Object.values(o).length:0})),M=T[0],R=T[1],z=(0,l.useState)((function(){return o&&Object.keys(o).includes(p.user.alunoid.toString())})),A=z[0],C=z[1];(0,l.useEffect)((function(){f.W.emit("join",{id:n},(function(){Object.values(o)&&R(Object.values(o).filter((function(e){return"like"==e})).length)})),f.W.on("get_message",(0,u.Z)(h().mark((function e(){var s,t;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g(n,k);case 2:s=e.sent,I(s.Message),t=s.reactions?Object.values(s.reactions).filter((function(e){return"like"==e})).length:0,R(t),C((function(){return o&&Object.keys(s.reactions).includes(p.user.alunoid.toString())}));case 7:case"end":return e.stop()}}),e)}))))}),[]);var W=function(e){E(O==e?void 0:e)},q=function(e,s,t,r){f.W.emit("send_reaction",{id:n,studentId:p.user.alunoid,type:e,messageId:s,fromStudentId:t,responseId:r})};return(0,a.jsxs)("article",{className:"flex flex-col mx-auto w-full max-w-2xl p-4 gap-4 rounded-md bg-white dark:bg-theme-gray-900 dark:text-white",children:[(0,a.jsxs)("header",{className:"flex gap-2",children:[(0,a.jsx)(v.Z,{title:"avatar",size:"small",path:(0,j.qR)(null===y||void 0===y||null===(s=y.avatar)||void 0===s?void 0:s.url)}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("h3",{className:"font-bold text-sm",children:null===y||void 0===y?void 0:y.primeiroNome}),(0,a.jsx)("p",{className:"text-xs",children:(0,j.Ny)(x,!1)})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-bold",children:i}),(0,a.jsx)(N.U,{children:c})]}),(0,a.jsxs)("footer",{className:"flex flex-col gap-2",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsxs)("button",{className:"flex items-center pl-1 pr-2 h-5 bg-gray-300 dark:bg-theme-gray-800 dark:text-white hover:bg-gray-400 rounded-full text-xs",children:[(0,a.jsx)("span",{children:"\u2764\ufe0f"}),(0,a.jsx)("span",{className:"ml-1 font-medium",children:M})]}),_.length>0&&(0,a.jsxs)("button",{className:"text-sm hover:underline",children:[_.length," coment\xe1rios"]})]}),(0,a.jsx)("div",{className:"flex gap-2",children:(0,a.jsxs)("button",{onClick:function(){return q("like")},className:"flex w-full border rounded-sm items-center justify-center gap-2 py-1 dark:border-theme-gray-800",children:[(0,a.jsx)(m.UZT,{className:"".concat(A?"text-blue-800 text-lg":"")}),(0,a.jsx)("span",{children:"Gostei"})]})})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("div",{children:(0,a.jsx)(w,{id:n,fromStudentId:p.user.alunoid})}),(0,a.jsx)("section",{className:"flex flex-col gap-2",children:_.map((function(e){return(0,a.jsxs)("div",{children:[(0,a.jsx)(b,(0,r.Z)((0,t.Z)({},e),{handleShowSender:W,handleReaction:q})),(0,a.jsx)("section",{className:"flex flex-col pl-6 gap-2 pt-1",children:e.MessageResponse.map((function(s){return(0,a.jsx)(b,(0,r.Z)((0,t.Z)({},s),{responseToMessageId:e.id,handleShowSender:W,handleReaction:q}),s.id)}))}),O===e.id?(0,a.jsx)("div",{className:"pl-6 py-1",children:(0,a.jsx)(w,{id:n,fromStudentId:p.user.alunoid,responseToMessageId:e.id})}):null]},e.id)}))})]})]},n)},S=!0,_=function(e){var s=e.token,n=e.me,u=e.live,x=e.news,h=e.post,m=(0,i.U)().config;return(0,l.useEffect)((function(){m(n)}),[]),(0,a.jsx)(o.s,{children:(0,a.jsxs)("section",{className:"flex flex-col-reverse lg:flex-row w-full",children:[(0,a.jsxs)("div",{className:"flex flex-col w-full gap-8 p-4 md:p-8 mb-20 md:mb-0",children:[(0,a.jsx)(d.B,{path:[{title:"Space",url:"/space"}]}),(0,a.jsx)("div",{className:"grid grid-cols-1 gap-4",children:(0,a.jsx)(y,(0,r.Z)((0,t.Z)({},h),{me:n,token:s}))})]}),(0,a.jsx)(c.x,{live:u,news:x})]})})}}},function(e){e.O(0,[13,186,987,111,999,874,164,449,835,592,536,185,366,774,888,179],(function(){return s=72934,e(e.s=s);var s}));var s=e.O();_N_E=s}]);